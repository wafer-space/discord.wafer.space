AuthorID,Author,Date,Content,Attachments,Reactions
"384390069412429834","polyfractal","2025-12-22T17:53:34.6990000+00:00","@Leo Moser (mole99) (not-important-question): I'm trying to familiarize myself with how LibreLane/OpenRoad works. In `gf180mcu/flows/chip.py` I see a list of steps that are executed for the whole flow. Then in `gf180mcu/steps/*` all the actual step processing logic and config/parameters lives, correct?

So when you add a `OpenROAD.Floorplan` step to `chip.py`, the corresponding logic is defined in the `Floorplan(OpenROADStep)` class residing in `steps/openroad.py`  Is that the gist of how it works?

context: was investigating adding an optional `rtl_macro_placer ` step to the flow  (ala https://github.com/librelane/librelane/issues/537).  Placing macros by hand was super tedious for me, and probably terrible layout performance üòÖ","",""
"1187141985530818611","ravenslofty","2025-12-22T17:58:59.7450000+00:00","yes, that's roughly correct","",""
"1187141985530818611","ravenslofty","2025-12-22T17:59:12.9840000+00:00","but you don't need to dump your plugin into there","",""
"1187141985530818611","ravenslofty","2025-12-22T17:59:51.6520000+00:00","for example, I wanted to play around with openroad's `rmp` step","",""
"1187141985530818611","ravenslofty","2025-12-22T17:59:56.7970000+00:00","```python
from decimal import Decimal
import os
from typing import Literal, Optional, Tuple

from librelane.steps.openroad import Step, TclStep, OpenROADStep, CompositeStep, State, Variable, ViewsUpdate, MetricsUpdate, dpl_variables
from librelane.common import get_script_dir, process_list_file

@Step.factory.register()
class RMP(OpenROADStep):
    id = ""OpenROAD.RMP""
    name = ""Restructure RMP""
    version = ""0.1.0""

    config_vars = OpenROADStep.config_vars + dpl_variables + [
        Variable(
            ""RMP_CORNER"",
            Optional[str],
            description=""IPVT corner to use during restructure. If unspecified, the value for `DEFAULT_CORNER` from the PDK will be used."",
            default=""max_ss_125C_4v50""
        ),
        Variable(
            ""RMP_TARGET"",
            Literal[""timing"", ""area""],
            description=""In area mode, the focus is area reduction, and timing may degrade. In delay mode, delay is likely reduced, but the area may increase"",
            default=""area"",
        ),
        Variable(
            ""RMP_SLACK_THRESHOLD"",
            Optional[Decimal],
            description=""Specifies a (setup) timing slack value below which timing paths need to be analyzed for restructuring"",
            default=Decimal()
        ),
        Variable(
            ""RMP_DEPTH_THRESHOLD"",
            Optional[int],
            description=""Specifies the path depth above which a timing path would be considered for restructuring"",
        ),
    ]

    def get_script_path(self):
        return ""~/gf180mcu-chess/restructure.tcl""

    def run(self, state_in: State, **kwargs) -> Tuple[ViewsUpdate, MetricsUpdate]:
        self.config = self.config.copy(DEFAULT_CORNER=self.config[""RMP_CORNER""])

        kwargs, env = self.extract_env(kwargs)
        lib_list = self.toolbox.filter_views(
            self.config, self.config[""LIB""], timing_corner=self.config.get(""RMP_CORNER"")
        )

        excluded_cells: Set[str] = set(self.config[""EXTRA_EXCLUDED_CELLS""] or [])
        excluded_cells.update(
            process_list_file(self.config[""SYNTH_EXCLUDED_CELL_FILE""])
        )
        excluded_cells.update(process_list_file(self.config[""PNR_EXCLUDED_CELL_FILE""]))
        trimmed_lib = self.toolbox.remove_cells_from_lib(
            frozenset([str(lib) for lib in lib_list]),
            excluded_cells=frozenset(excluded_cells),
        )

        env[""_RMP_LIB""] = TclStep.value_to_tcl(trimmed_lib)
        env[""_RMP_ABC_LOG""] = TclStep.value_to_tcl(
            os.path.join(self.step_dir, ""abc.log"")
        )
        env[""RMP_CORNER""] = TclStep.value_to_tcl(self.config.get(""RMP_CORNER""))
        return super().run(state_in, env=env, **kwargs)

@Step.factory.register()
class RMPPlus(CompositeStep):
    id = ""OpenROAD.RMPPlus""
    Steps = [
        RMP,
        Step.factory.get(""OpenROAD.GlobalPlacement""),
        Step.factory.get(""OpenROAD.DetailedPlacement""),
        Step.factory.get(""OpenROAD.GlobalRouting""),
    ]
```","",""
"384390069412429834","polyfractal","2025-12-22T18:02:26.5380000+00:00","ooh interesting. where do ""user plugins"" live in the project template, and how do you specify where the step is inserted into the standard chip flow? Might be missing it from skimming that code but I don't think I see how it slots into the flow? Or is it run as a standalone step?","",""
"1187141985530818611","ravenslofty","2025-12-22T18:03:14.8380000+00:00","anything which is in `PYTHONPATH`, and which has a filename which begins with `librelane_plugin_`","",""
"1187141985530818611","ravenslofty","2025-12-22T18:03:23.7350000+00:00","(e.g. the above file is called `librelane_plugin_rmp.py`)","",""
"1187141985530818611","ravenslofty","2025-12-22T18:04:16.9540000+00:00","> how do you specify where the step is inserted into the standard chip flow?
same as any other step in the flow; you add it in `librelane/config.yaml` under `substituting_steps`.","",""
"384390069412429834","polyfractal","2025-12-22T18:05:08.4060000+00:00","oh! I didn't realize that's what the `substituting_steps` section was for (makes sense in retrospect). awesome, thank you!","",""
"384390069412429834","polyfractal","2025-12-22T18:06:57.1000000+00:00","so just to check my understanding, for your `rmp` you would have nulled out the `GlobalPlacement`, `DetailedPlacement` and `GlobalRouting` , then inserted your `RMP` to run (and which includes the others)?","",""
"1187141985530818611","ravenslofty","2025-12-22T18:09:45.4330000+00:00","actually, the intent was to run those, and then `OpenROAD.RMPPlus` afterwards to try to use the information","",""
"1187141985530818611","ravenslofty","2025-12-22T18:09:53.3630000+00:00","||but RMP sucks, so it didn't help any||","",""
"384390069412429834","polyfractal","2025-12-22T18:10:00.4070000+00:00","hehe","",""
"384390069412429834","polyfractal","2025-12-22T18:10:04.3070000+00:00","gotcha üôÇ üëç","",""
"1187141985530818611","ravenslofty","2025-12-22T18:12:05.7360000+00:00","I know it's quite insulting to call things like this *toys*, but having passes that have little documentation, only work in very specific situations and have crippling flaws, mixed in alongside the Serious Stuff for Serious People makes it confusing to know what to use","",""
"1187141985530818611","ravenslofty","2025-12-22T18:12:16.3940000+00:00","*cough*","",""
"1187141985530818611","ravenslofty","2025-12-22T18:12:17.4610000+00:00","anyway","",""
"384390069412429834","polyfractal","2025-12-22T18:14:48.8290000+00:00","state of documentation in general was a real hindrance to me personally (as a complete newbie). Even simple things, like is this parameter unitless? nanoseconds? percentage? who knows! üôÉ 

And even moreso for how parameters interact. optimizing was a lot of tweaking and seeing how it adjusted things","",""
"384390069412429834","polyfractal","2025-12-22T18:15:10.4890000+00:00","(not project template that is, Openroad/librelane)","",""
"384390069412429834","polyfractal","2025-12-22T18:16:18.3540000+00:00","that said I recognize docs are hard and no fun for OSS contributors üôÇ","",""
"1187141985530818611","ravenslofty","2025-12-22T18:16:26.3140000+00:00","tbqh I have decided to do something very stupid in the hopes of improving gf180mcu performance :p","",""
"384390069412429834","polyfractal","2025-12-22T18:16:51.5760000+00:00","oh? any details to share or wait until the silicon is back?","",""
"1187141985530818611","ravenslofty","2025-12-22T18:17:37.1760000+00:00","you might be aware that tholin's been working on a new standard cell library","",""
"1187141985530818611","ravenslofty","2025-12-22T18:18:28.4370000+00:00","well, I've decided to make a new standard cell library too","",""
"1187141985530818611","ravenslofty","2025-12-22T18:18:42.9290000+00:00","except I'm going with domino logic","",""
"384390069412429834","polyfractal","2025-12-22T18:20:56.8710000+00:00","oooh neat! will have to do some reading on that, only passingly familiar","",""
"384390069412429834","polyfractal","2025-12-22T18:28:42.0710000+00:00","(had a quick refresher, very cool! can't wait to see how it turns out üôÇ )","",""
