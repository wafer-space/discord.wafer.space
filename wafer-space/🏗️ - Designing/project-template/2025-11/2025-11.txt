==============================================================
Guild: wafer.space Community
Channel: üèóÔ∏è - Designing / project-template
==============================================================

[10/02/2025 16:40] mole99
üì¢ Major update to the [gf180mcu-project-template](https://github.com/wafer-space/gf180mcu-project-template)! 

The example design now runs through the complete flow, including:

- Sealring insertion
- Filler generation

... and is DRC and LVS clean, according to the open source PDK.

There is now also a [cocotb](https://www.cocotb.org/) testbench available in the repository. We use the newly released cocotb 2.0.0.
You can run RTL as well as GL simulations, after implementing the design.

To ensure your design will be accepted for tapeout, you will be able to run the [gf180mcu-precheck](https://github.com/wafer-space/gf180mcu-precheck).
At the moment it is still a work in progress.

Further updates will follow, but you can use the current state as a stable basis for implementing your design.
If you encounter any issues, please report them so that we can improve both the template and the PDK.

PS: Special thanks to @Tim Edwards for his help in solving the uncovered PDK and tool-related issues.

Leo

{Reactions}
üëç (2)

[10/02/2025 16:45] rtimothyedwards_19428
Tim Edwards has only barely begun to address all the issues that have surfaced over the past few weeks. . .


[10/02/2025 16:48] tholin
Its that bad?


[10/02/2025 16:48] mole99
Haha, I also have to upstream a number of LibreLane related patches üòÑ


[10/02/2025 16:51] mole99
Also I forgot to mention that it is now possible to adjust the padring directly from the LibreLane configuration file.


[10/02/2025 17:09] h.tamas
Started a thread.


[10/02/2025 18:04] rtimothyedwards_19428
@Tholin :  Well, it means there's a lot to do if we want people to have successful tapeouts.


[10/02/2025 18:10] tholin
Bad time for me to be designing analog layouts?


[10/02/2025 18:15] rtimothyedwards_19428
@Tholin :  Great time for you to be designing analog layouts!  That will help flush out a lot of issues.  Make sure that you spot-check designs against the documented rules occasionally and let me know about anything that looks wrong.  Feel free to post a layout to me if you want me to double-check it for issues.


[10/02/2025 18:16] mithro_
See what @Tim Edwards said! üôÇ


[10/02/2025 18:20] tholin
Alright, sounds good.


[10/02/2025 18:20] tholin
I'll keep going.


[10/04/2025 01:11] xintingjiang_36756
I'm curious what is the current problem of this template, is this made the nov gf180 mpw shuttle


[10/04/2025 01:23] mithro_
@Xinting Jiang - It should be usable but just keep it up to date as you go.

{Reactions}
üëç

[10/04/2025 07:35] mole99
Exactly. You can already get started with your design, just make sure to keep it up to date with the upstream template.

{Reactions}
üëç

[10/11/2025 03:01] asc9742
@mole99 Hi Leo, I am trying to replace all 56 user pads with analog pads (gf180mcu_fd_io_asig_5p0). Got this error "No shape in terminal analog[0\].pad/ASIG5V found on layer Metal5". Any ideas on this issue? Attached a screenshot + the yaml and system verilog files.

{Attachments}
project-template_media/image-B347D.png
project-template_media/config_sv_files-19959.zip


[10/11/2025 08:20] mole99
Hi @asc, there was a port missing for the bondpad BTerm in the `gf180mcu_fd_io__asig_5p0` cell.
If you update your PDK, it should run through now.

{Reactions}
üëç

[10/11/2025 16:52] asc9742
Thank you @mole99 Ran into a new problem with the global routing. I had exchanged all user pads with analog pads, including the clk and rst pad. Could that be causing an issue?

{Attachments}
project-template_media/image-6899C.png


[10/12/2025 05:21] mole99
Yes, that will be a problem. The SDC expects at least one clock. Can you share a repository with your current state? I will take a look tomorrow.


[10/13/2025 11:59] mole99
Started a thread.


[10/16/2025 13:48] mole99
The [precheck](https://github.com/wafer-space/gf180mcu-precheck) has been updated to finish cleanly with the example project.
The precheck is your gateway to fabrication and will need to be completed via the online platform (coming soon).
You can, of course, run it locally to more easily debug failures.

If you are working on a design, please give it a try and let us know how it goes (SRAMs should still throw errors, that's being worked on next).
Most importantly: please let us know if you can "cheat" your way through the precheck üòâ


[10/16/2025 14:07] tholin
@mole99 I just updated my project with the changes from the template and since one of the commits reads "Update LibreLane", I tried running LL on example_project again to see if the error during GLB is gone. Instead, it now fails even earlier during STA.


[10/16/2025 14:35] mole99
Started a thread.


[10/16/2025 20:46] jalf_47390
@mole99 Is there any ESD protection in the IO pins in the template or is it required to be added? If it is in there already, what did you include? Same for all pins differences between them?


[10/17/2025 04:56] mole99
Started a thread.


[10/20/2025 01:08] polyfractal
how much memory does the `make librelane` step need (roughly)? I fired up an old linux laptop to play around with everything and it crashed after eating 16gb RAM + 4gb swap üôÇ  Curious if I should just increase swap and let it run, or if it really needs like 32 or 64gb?


[10/20/2025 03:58] polyfractal
more swap did the trick üôÇ

{Reactions}
waferspace üëç

[10/20/2025 06:32] mole99
It depends on your design üòÅ
Yesterday, I implemented the example template on my laptop, which also has 16 GB of RAM, and it had to use swap as well.

The step that uses the most memory atm is most likely the filler generation.
There you can easily trade off memory consumption by changing the number of tiles (threads) and their size.
I will add some LibreLane configuration variables so that this can be easily tweaked directly from the config.
In the meantime, you can pass the `--jobs` argument to LibreLane to limit the global thread limit across all steps.

{Reactions}
üëç

[10/20/2025 07:40] mole99
Never mind, none of that will be necessary anymore üòÖ

I've just fixed an embarrassing bug in the filler generation script: https://github.com/wafer-space/gf180mcu/commit/57a5725eb4a722cb148ff8cf84c5f22ce0be8d64
Now, filler generation uses only a fraction of the memory and completes much faster.
Always double check how functions are supposed to be used (the naming actually said it all üòÑ).

{Embed}
https://github.com/wafer-space/gf180mcu/commit/57a5725eb4a722cb148ff8cf84c5f22ce0be8d64
bugfix!: specify the tile margin as just the tile margin without th...
‚Ä¶tile size

Signed-off-by: Leo Moser <leomoser99@gmail.com>
project-template_media/57a5725eb4a722cb148ff8cf84c5f22ce0be8d64-8D20B


[10/20/2025 07:42] mole99
üì¢ Please update your project templates and pull the latest changes from the PDK!


[10/20/2025 13:51] polyfractal
awesome, thanks @mole99!

{Reactions}
üëå

[10/20/2025 22:17] mattvenn
when will the submission system be open?

{Reactions}
üíú

[10/21/2025 06:22] mole99
That's for @Tim 'mithro' Ansell to say.


[10/21/2025 08:53] mithro_
@Matt Venn - Hopefully in the next week.


[10/26/2025 19:54] tholin
That's quite a lot of VDD and VSS pads on the template. Like 10 each. That seems a bit excessive. What is the max current per pad?


[10/27/2025 02:50] mithro_



[10/27/2025 02:51] mithro_
@Tholin - That was from @tnt in the #cob channel.


[10/27/2025 08:12] tholin
Ah, I see. Thank you.


[11/01/2025 19:17] tholin
Getting some *extreme* hold violations when integrating a macro into chip_top that is not present when hardening the macro itself. Checking the logs, the worst slack is simply from the reset pad.

{Attachments}
project-template_media/image-91CC9.png


[11/01/2025 19:21] markemer
Is that in ns? If so, oof. And could it be a bad capacitance extraction on the pads themselves?


[11/01/2025 19:28] 246tnt
That's probably because the macro has its own clock tree. So the clock that its internal FF sees is delayed by many ns compared to the clock on its input pin.


[11/01/2025 19:29] 246tnt
If the CTS inside your top level project isn't setup to feed the macro an "early clock" (i.e. from the root of its clock tree instead of a leaf), that could explain why you see so many hold violations.


[11/01/2025 19:30] 246tnt
(Just a theory of course ... can't do more than theorize without more data)


[11/01/2025 19:45] tholin


{Attachments}
project-template_media/image-226EA.png


[11/01/2025 19:45] tholin
I don't have a repo for this yet


[11/01/2025 19:46] tholin
There is no CTS in the top level


[11/01/2025 19:46] tholin
Actually, there is no standard cells in the top level


[11/01/2025 19:46] tholin
Just macros


[11/01/2025 20:56] tholin
I guess this calls for a custom SDC file. I started by copying the SDC file provided by efabless for user project macros and will progressively modify it.


[11/01/2025 22:33] tholin
Literally nothing I do is changing the hold violations. Its refusing to budge.


[11/02/2025 16:16] tholin
Almost got it. Commit soon. Just trying to clean up my SDC file.


[11/02/2025 16:17] tholin
What‚Äôs the point of `set_driving_cell`? Does it automatically determine slew rates and delays, or do I still need to specify those manually?


[11/02/2025 16:42] tholin
Doesn‚Äôt matter. I cannot `set_driving_cell -lib_cell gf180mcu_fd_io__bi_24t` inside my macro SDC files anyways:

{Attachments}
project-template_media/image-55734.png


[11/02/2025 18:10] mole99
Do you use the LibreLane version from the template or [this branch](https://github.com/librelane/librelane/pull/806)?
Otherwise the pad cells are not read in.


[11/02/2025 18:16] tholin
I cannot use the LibreLane version from the template for my macros. Python error.

{Attachments}
project-template_media/image-BC7E4.png


[11/02/2025 18:17] tholin
I mean, the PDK Version


[11/02/2025 18:18] tholin
The error during GPL I reported before persists, so I cannot use the LibreLane version.


[11/02/2025 18:21] tholin
But I also don‚Äôt understand what `set_driving_cell` even does. Right now my approach has been to determine values to set on `set_input_delay` , `set_clock_latency`, `set_input_transition` and `set_clock_transition` by manually interpreting the values in the liberty files for the IO pads.


[11/02/2025 18:21] tholin
Except when it comes to the internal bus inside the chip, where I have to rely on STA for numbers.


[11/02/2025 18:23] tholin
Actually, it seems fine now, at least on this one macro, but there is still a big difference in behavior.


[11/02/2025 18:24] tholin
I just got to `Stage 37 - Resizer Timing Optimizations (Post-Clock Tree Synthesis)` on this CPU macro and on Iteration 0 its starting with a TNS of **-5042** compared to main librelane, where I got -250.


[11/02/2025 18:24] tholin
I changed nothing about the config.


[11/02/2025 18:24] tholin
Just switched LL versions.


[11/02/2025 19:22] tholin
Yeah, I‚Äôm getting severe performance degradation in the wafer.space template LL version in two ways. The timings of the design are worse, and also the flows take forever to run. After one hour, it is still stuck in Timing Optimizations. This whole flow used to take < 15 minutes. @mole99


[11/03/2025 00:24] tholin
@mole99 This page linked in the README of the template no longer exists.

{Attachments}
project-template_media/image-C502E.png


[11/03/2025 00:24] tholin


{Attachments}
project-template_media/image-6E9A7.png


[11/03/2025 07:16] mole99
The wafer.space gf180mcu PDK requires the LibreLane version in the template (or from the branch).


[11/03/2025 07:17] mole99
The issue is still open at OpenROAD's side: https://github.com/The-OpenROAD-Project/OpenROAD/issues/8229
However, as mentioned before, you can simply disable timing driven placement.


[11/03/2025 07:18] mole99
`set_driving_cell` automates exactly that. It takes the values directly from the LIB.


[11/03/2025 07:19] mole99
Thanks for reminding me. The LibreLane docs have recently been updated.


[11/03/2025 08:12] tholin
Thank you. I could find 0 information about this command online.


[11/03/2025 08:23] 246tnt
https://github.com/The-OpenROAD-Project/OpenSTA/blob/master/doc/OpenSTA.pdf

{Embed}
https://github.com/The-OpenROAD-Project/OpenSTA/blob/master/doc/OpenSTA.pdf
OpenSTA/doc/OpenSTA.pdf at master ¬∑ The-OpenROAD-Project/OpenSTA
OpenSTA engine. Contribute to The-OpenROAD-Project/OpenSTA development by creating an account on GitHub.
project-template_media/OpenSTA-8A0D3


[11/03/2025 20:35] mole99
This is the ‚ú® magic ‚ú® line for the `gf180mcu_fd_ip_sram__sram512x8m8wm1` SRAM:

```
add_pdn_stripe -grid macro -layer Metal4 -width 2.36 -offset 1.18 -spacing 0.28 -pitch 426.86 -starts_with GROUND -number_of_straps 2
```

It adds a power/ground pair on each side of the SRAM macro, directly above the pins. Since this uses the local coordinate system of the macro, you can move the macro around as you wish, the PDN straps will follow. As the PDN straps go all the way across the macro, connecting them to the PDN above is very easy.

{Reactions}
‚ú® üíØ

[11/03/2025 20:35] mole99
(top left)

{Attachments}
project-template_media/Bildschirmfoto_vom_2025-11-03_21-13-08-89A4F.png


[11/03/2025 20:35] mole99
(top right)

{Attachments}
project-template_media/Bildschirmfoto_vom_2025-11-03_21-13-33-4F47A.png


[11/03/2025 20:35] mole99
If you rotate the SRAM by 90 or 270 degrees, you need to use this line:

```
add_pdn_stripe -grid sram_macros_WE -layer Metal4 -width 2.36 -offset 1.18 -spacing 0.28 -pitch 479.88 -starts_with GROUND -number_of_straps 2
```

Unfortunately, the connection to VSS is not as good on the right side. It is better to use the first orientation.

Don't forget the PDN connect:

```
add_pdn_connect \
    -grid macro \
    -layers "$::env(PDN_VERTICAL_LAYER) Metal3"
```


[11/03/2025 20:35] mole99


{Attachments}
project-template_media/Bildschirmfoto_vom_2025-11-03_21-30-41-0737D.png


[11/03/2025 20:35] mole99
Now I just need to make magic DRC happy, and then I can push the the example usage of the SRAM to the template repo.


[11/03/2025 20:36] tholin
Awesome


[11/03/2025 20:36] tholin
I re-used my setup from GFMPW with a wrapper macro for the SRAM that just added the Metal4 strips.


[11/03/2025 20:36] tholin
Which is not optimal


[11/03/2025 20:37] mole99
Well, if I remember correctly, Efabless used your solution too :)


[11/03/2025 20:37] tholin
Yeah. That‚Äôs where I got it from.

{Reactions}
üëç

[11/03/2025 20:45] mole99
Started a thread.


[11/05/2025 05:53] greg.hashtag.9468
I've setup a new system following the readme. And then just run the stock template as a sanity check, it does complete. But I'm seeing KLayout DRC errors. (along with timing/cap/slew warnings at some corners)
```
...
    "DM4.8": 0,
    "DF.12": 3,
    "NW.2b_MV": 16,
    "DPF.4": 38,
    "DCF.4": 48,
    "total": 105
}
```
Is this expected? Or does it indicate something I should debug with my environment first?


[11/05/2025 07:38] mole99
Started a thread.


[11/06/2025 10:32] mole99 (pinned)
üì¢ It's update time!

The project template has been updated with support for the foundry SRAMs!
Two SRAMs of type `sram512x8m8wm1` are instantiated in `chip_core` and placed inside the chip in two different orientations (north and east).
If you add more SRAMs, make sure to update the LibreLane config (`librelane/config.yaml`) and the PDN configuration (`librelane/pdn_cfg.tcl`).

In addition, an issue has been fixed with filler generation, the way how the KLayout DRC deck was invoked (connectivity rules), and an error in the seal ring generator. With these changes the template is now DRC clean for both the magic and KLayout DRC deck.
Furthermore, the design is LVS clean and the there are no setup and hold violations for this example.

Please update your projects to the latest template, and don't forget to update the PDK as well (`make clone-pdk`).
Let me know if you have any questions.

{Reactions}
waferspace (5) üëç (2) üéâ

[11/06/2025 22:46] tholin
Updated my AS2650v2 wafer.space port to use the new method for instantiating SRAMs.

{Reactions}
üíú

[11/06/2025 22:46] tholin
Works!


[11/07/2025 05:46] mole99
Great to hear üëèüèª


[11/07/2025 12:03] mithro_
Pinned a message.


[11/07/2025 12:04] mithro_
@mole99 - Has performance / RAM usage changed much in the latest updates?


[11/07/2025 12:26] mole99
RAM usage has gone down drastically during the filler generation step after I fixed a bug there. However, that was already before this update.


[11/17/2025 10:35] 246tnt
How long does the template build (default) take for people ?


[11/17/2025 10:35] 246tnt
Just wondering if my vm is slow or something ...


[11/17/2025 10:39] mole99
The CI takes around 50mins without DRC: https://github.com/wafer-space/gf180mcu-project-template/actions/runs/19297076321/job/55181634117
Locally, it's faster for me. The DRC can then take an additional 1‚Äì1.5 hours.

{Reactions}
üëç

[11/17/2025 13:35] 246tnt
Here full run took 3h30 üòÖ 
Looking at timestamps, klayout drc was 2h 48 min of that.


[11/17/2025 13:36] tholin
What? My top-level DRC runs don't take nearly as long.


[11/17/2025 13:37] tholin
I'm also still struggling with analog pads not getting wired up.


[11/17/2025 14:18] mole99
Just had a full run (inlcuding DRC) in 48:05 using the template üòÅ


[11/17/2025 14:21] 246tnt
Huh ... that's worrying ...


[11/17/2025 17:57] tholin
Something changed. KLayout DRC is so much slower now.


[11/17/2025 18:52] mole99
There haven't been changes to the PDK for two weeks: https://github.com/wafer-space/gf180mcu
Although a number of changes are coming up.

{Embed}
https://github.com/wafer-space/gf180mcu
GitHub - wafer-space/gf180mcu: Temporary development repository for...
Temporary development repository for the gf180mcuD PDK variant. - wafer-space/gf180mcu
project-template_media/gf180mcu-6FE46


[11/17/2025 21:17] tholin
And why are my analog signals not getting routed?

{Attachments}
project-template_media/image-C20A2.png

{Reactions}
üòÆ

[11/17/2025 21:31] tholin
I CTRL+F‚Äôd for "analog" in the global routing logs and found nothing. Its skipping it.


[11/17/2025 21:33] 246tnt
Are they defined any differently in your netlist ?


[11/17/2025 21:35] tholin
No


[11/18/2025 11:26] rzioma
Z80 design is finally green on github \o/
@mole99 is there a way to download artifacts / GDS from github job for local inspection? *I feel quite dumb for asking, but I couldn't figure how to do it so far*

{Attachments}
project-template_media/image-95F6F.png

{Reactions}
üéâ

[11/18/2025 11:30] rzioma
Ah, when building locally on Mac it is necessary to increase file-descriptor count otherwise Magic streamout fails `ulimit -n 1024`


[11/18/2025 11:32] rzioma
@mole99 I tried to add `ulimit` to flake.nix as shell hook, but failing so far even with ChatGPT *"help"* üòì


[11/18/2025 11:43] mole99
Hi ReJ! Congrats üëè
Just so you know, the CI only runs the implementation, as the DRC requires too much memory. So you need to make sure to run DRC locally.

Yes, there are ways to upload artifacts: https://docs.github.com/en/actions/tutorials/store-and-share-data
I haven't added this to the CI yet since I though it would quicky fill up the available storage space. But perhaps with a compression of the artifacts and a short retention time, it could be fine?

{Reactions}
‚ù§Ô∏è

[11/18/2025 11:45] rzioma
For some reason I get hold violations when I build locally (MacOS could be a problem here üòâ ), but it is fine building on github. Investigating atm.


[11/18/2025 11:59] mole99
The Nix flake in the template uses LibreLane's create-shell: https://github.com/librelane/librelane/blob/dev/nix/create-shell.nix
It seems that mkShell has a `shellHook` that could be used for that. However, I'm not sure how to override this from the template.

{Reactions}
üëç

[11/18/2025 12:02] mole99
Strange. There may be slight differences between the Linux and mac version of OpenROAD. If your hold violations are only just over the limit, perhaps that could make the difference.
Make sure your clock tree is good, and you could increase the `PL_RESIZER_HOLD_SLACK_MARGIN`.


[11/18/2025 12:21] tholin
All of my configs contain
```
GRT_RESIZER_HOLD_SLACK_MARGIN: 0.1
PL_RESIZER_HOLD_SLACK_MARGIN: 0.1
PL_RESIZER_HOLD_MAX_BUFFER_PCT: 100
```
by default now since I had hold violations screw me over before.

{Reactions}
üëç

[11/18/2025 12:45] bailey8889
@ReJ aka Renaldas Zioma If you're just running a batch job with no editing, you probably don't need file locking. Disabling this with the magic command `locking disable` may allow you to load large designs without changing the ulimit. http://opencircuitdesign.com/magic/commandref/locking.html

{Reactions}
üëç

[11/18/2025 15:43] _luke_w_
Is it expected to get some antenna violations from building the project template?
```
* Antenna
Failed êÑÇ
Pin violations: 17
Net violations: 11
Check the report directory of OpenROAD.CheckAntennas.
```

checking the CI run here I do see the same violations: https://github.com/wafer-space/gf180mcu-project-template/actions/runs/19297076321/job/55181634117

{Embed}
https://github.com/wafer-space/gf180mcu-project-template/actions/runs/19297076321/job/55181634117
Remove `set_driving_cell` from SDC file ¬∑ wafer-space/gf180mcu-pro...
Project template for wafer.space MPW runs using the gf180mcu PDK - Remove `set_driving_cell` from SDC file ¬∑ wafer-space/gf180mcu-project-template@9b6c284
project-template_media/gf180mcu-project-template-DF039


[11/18/2025 15:47] 246tnt
Yes


[11/18/2025 15:47] _luke_w_
Ok, thanks üôÇ are they concerning or just something to waive?


[11/18/2025 16:08] mole99
That is something that requires a closer look into OpenROAD and LibreLane in order to find a proper solution. For large ratios you can manually insert ECO diodes.

So far, most (all?) Tiny Tapeout designs seem to work just fine, and almost all of them have some antenna violations.

{Reactions}
‚ù§Ô∏è

[11/18/2025 16:09] mole99
Search for `INSERT_ECO_DIODES` in https://librelane.readthedocs.io/en/latest/reference/step_config_vars.html


[11/18/2025 17:25] _luke_w_
Thanks, I guess I'll worry about that later then üòÖ

{Reactions}
üòÅ

[11/18/2025 17:25] _luke_w_
In `chip_core.sv` in the example project, why does it have `keep` attributes on the SRAM? Are they just left in from initial hacking or are they required?

```
    logic [7:0] sram_0_out;

    (* keep *)
    gf180mcu_fd_ip_sram__sram512x8m8wm1 sram_0 (
        `ifdef USE_POWER_PINS
        .VDD  (VDD),
        .VSS  (VSS),
        `endif

        .CLK  (clk),
        .CEN  (1'b1),
        .GWEN (1'b0),
        .WEN  (8'b0),
        .A    ('0),
        .D    ('0),
        .Q    (sram_0_out)
    );
```


[11/18/2025 17:26] _luke_w_
I will happily cargo cult it into my own memory wrappers, I was just curious


[11/18/2025 17:28] mole99
The former. You should be able to remove the `(* keep *)` and since Yosys sees that the outputs of the macro are being used, it will keep it. I'll remove it the next time I push another change to the template :)


[11/18/2025 17:29] _luke_w_
ok nice thanks, I thought that would be the case but wasn't sure if there were hidden gotchas

{Reactions}
üëç

[11/18/2025 17:30] _luke_w_
flow related question (if the answer is "RTFM" I can attempt to do that): in our ASIC flow at work, if I hand-instantiate a cell then the buffer width can be changed during layout but otherwise it'll remain the same cell with the same hierarchical path. Is that the case here or do I need to add `(* dont_touch keep *)` etc to my cell wrappers?


[11/18/2025 17:34] mole99
Cell attributes are currently not retained. You can set `SYNTH_WRITE_NOATTR` to false and they should be passed on to OpenROAD.
However, there's `RSZ_DONT_TOUCH_RX` and `RSZ_DONT_TOUCH_LIST` if you want to keep a cell or net untouched.
I think if you just set the `(* keep *)` attribute on a stdcell, Yosys will instantiate the stdcell and OpenROAD is free to change it's buffer width.

{Reactions}
üëç

[11/18/2025 17:34] _luke_w_
nice, thanks


[11/18/2025 17:35] _luke_w_
so it sounds like just putting `(* keep *)` on my cells is what I want; quite happy for the tools to change the drive as I don't fancy going and fixing all the transition violations myself üôÇ

{Reactions}
üëå

[11/18/2025 17:44] h.tamas
FYI time driven placement (enabled by default) ignores the `RSZ_DONT_TOUCH_*` setting and resizes the cells nonetheless. You can work around it by setting `PL_TIME_DRIVEN` to 0.


[11/18/2025 17:47] mole99
Yes, that is actually a "bug" in LibreLane as `dont_touch` does not prevent placement. So we could actually keep the attribute throughout GPL. See here: https://github.com/librelane/librelane/issues/695

{Reactions}
üëç

[11/18/2025 20:32] _luke_w_
Some incredibly minor DRCs (SRAM VDD/VSS *completely unconnected* while I figure out how the hierarchical paths are escaped) but in theory here is a processor, JTAG and 4 kB of RAM. Thanks for making the template, it made it super fast to get started üòÑ

{Attachments}
project-template_media/image-DCA97.png

{Reactions}
‚ù§Ô∏è (3) üéâ (2)

[11/18/2025 20:35] _luke_w_
Also I may have mixed up the SRAM dimensions and there is only a 15 um routing channel between the two rows ü§î


[11/18/2025 22:57] _luke_w_
I'm guessing it's expected that the `librelane-magicdrc` makefile target crashes out during klayout/magic XOR, since klayout was skipped?


[11/18/2025 22:59] _luke_w_
i.e.

```
Reading /home/luke/proj/riscboy-180/librelane/runs/RUN_2025-11-18_22-06-42/56-magic-streamout/chip_top.magic.gds ..
ERROR: In /nix/store/g3fml7j9yabcq2cmqm5yh19fxrm1h919-python3-3.12.10-env/lib/python3.12/site-packages/librelane/scripts/klayout/xor.drc: 'source': Stream has unknown format: /home/luke/proj/riscboy-180/librelane/runs/RUN_2025-11-18_22-06-42/56-magic-streamout/chip_top.magic.gds in Layout::read
Total elapsed: 0.010s  Memory: 413.00M
ERROR: RuntimeError: 'source': Stream has unknown format: /home/luke/proj/riscboy-180/librelane/runs/RUN_2025-11-18_22-06-42/56-magic-streamout/chip_top.magic.gds in Layout::read in Executable::execute
  /nix/store/g3fml7j9yabcq2cmqm5yh19fxrm1h919-python3-3.12.10-env/lib/python3.12/site-packages/librelane/scripts/klayout/xor.drc:78:in `execute'
  :/built-in-macros/drc_interpreters.lym:31:in `instance_eval'
  :/built-in-macros/drc_interpreters.lym:31:in `execute'
/home/luke/proj/riscboy-180/librelane/runs/RUN_2025-11-18_22-06-42/56-magic-streamout/chip_top.magic.gds
/home/luke/proj/riscboy-180/librelane/runs/RUN_2025-11-18_22-06-42/57-klayout-streamout/chip_top.klayout.gds
```

if it's a known issue with that target then I won't bother debugging üôÇ


[11/18/2025 23:05] _luke_w_
Does this YAML config go anywhere other than `chip_top.sdc`?

```
# Clock
CLOCK_PORT: clk_PAD
CLOCK_NET: clk_pad/Y

CLOCK_PERIOD: 40 # 25 MHz
```

I saw the warning about multiple clocks in there but hoping I can just ignore that and write a normal `.sdc` file.


[11/19/2025 07:20] mole99
Started a thread.


[11/19/2025 07:22] mole99
From what I know, this is only passed on to the SDC file.
Yes, you should be able to fully customize your SDC.

{Reactions}
üëç

[11/19/2025 07:50] rzioma
DRC is passing (minus some antenna violations).
Tiny Z80 looks so lonely in there.

{Attachments}
project-template_media/Pasted_Graphic_12-0D70E.png

{Reactions}
blobclap (4)

[11/19/2025 07:55] rzioma
@mole99  However I ran into some problems with `gf180mcu-precheck` repository. It:
- crashes on my Ubuntu machine (*perhaps running out of memory, investigating*) during the Density check
- fails to find qrcode library on OSX machine (*Error: Couldn't load the qrcode library.  *)


[11/19/2025 07:58] mole99
Congrats! üëè
You did enable the environment within the precheck, right?
Because I specifically request the `qrcode` Python module üòÖ
https://github.com/wafer-space/gf180mcu-precheck/blob/1b639dff3d87a50e0759541701c7d162e1765630/flake.nix#L47


[11/19/2025 08:03] rzioma
ah, this might be the problem `pkgs.stdenv.isLinux`

{Reactions}
üòÜ

[11/19/2025 08:04] mole99
You're absolutely right! It's a leftover from a different flake, I completely overlooked it.


[11/19/2025 08:05] mole99
Pushing a fix shortly...

{Reactions}
‚ù§Ô∏è

[11/19/2025 08:09] mole99
@ReJ aka Renaldas Zioma You can give it another try now.

{Reactions}
üëç

[11/19/2025 11:00] rzioma
Worked like a charm. Precheck passed!

{Reactions}
ü•≥ (2)

[11/19/2025 14:55] polyfractal
is there an additional log to get more information about librelane build failures? Trying a test build of what I have to see the end-to-end workflow, and it's failing to wire up power pins to my sram macos (deep in the bowels of my project)

```
Connecting power net VDD to i_chip_core.u_core.tta_0.lsu_fu_0.sram_512x32_0.gf180mcu_fd_ip_sram__sram512x8m8wm1_0/VDD‚Ä¶
[INFO] Made 0 connections.
[06:50:13] ERROR    The following error was encountered while running the flow:  __main__.py:189 
    Odb.SetPowerConnections failed with the following errors:
         add_global_connections failed to make any connections for 'i_chip_core.u_core.tta_0.lsu_fu_0.sram_512x32_0.gf180mcu_fd_ip_sram__sram512x8m8wm1_0/VDD' to VDD. 
```

I've gone through and added the conditional stuff where needed
```
`ifdef USE_POWER_PINS
.VDD  (VDD),
.VSS  (VSS),
`endif
```


[11/19/2025 14:59] polyfractal
ah... yosys is deleting my sram module (and a bunch of other stuff)

`Deleting now unused module tta::sram::sram_512x32.  `

{Reactions}
üëç

[11/19/2025 15:00] polyfractal
ok new question.... why? üòÇ  I know there's a "keep" annotation to force it, but I don't think any of this is dead code? but I have no idea how synthesizing works


[11/19/2025 15:00] mole99
You can find all log files and artifacts in the `librelane/runs/*` directory.
Making the power connections in the RTL is one way, the other is to use `PDN_MACRO_CONNECTIONS`.

{Reactions}
üëÄ

[11/19/2025 15:01] polyfractal
aha! `PDN_MACRO_CONNECTIONS` looks much more convenient


[11/19/2025 15:01] mole99
Yes, if Yosys removes the SRAM instances, it's because it recognises that none of the outputs are being used. Optoimizing it away üòÅ


[11/19/2025 15:02] mole99
So there is probably an issue in your RTL.


[11/19/2025 15:06] polyfractal
hm, it seems to be deleting basically my entire project üòÑ

{Attachments}
project-template_media/image-5CCBB.png


[11/19/2025 15:09] polyfractal
if a module doesn't have an output, does it get optimized away? I've only wired up inputs to my processor so far (clock, reset, uart loading, etc). so it can run programs but no output


[11/19/2025 15:13] tholin
Yes. Yosys checks input to output paths to see what it can optimize away, in my experience.

{Reactions}
üëç

[11/19/2025 15:13] tholin
If it sees 0 outputs, it just goes "this whole design is just void"


[11/19/2025 15:13] polyfractal
argh


[11/19/2025 15:14] polyfractal
gotcha, thanks!


[11/19/2025 15:55] polyfractal
wired in a temporary output, got the ball moving again! Just to confirm, it looks like the sram macros have to be placed manually on the die? (I see the placement stuff in pdn_cfg.tcl for the two macros in the demo chip_top)


[11/19/2025 15:55] polyfractal
and in the config toml


[11/19/2025 15:58] mole99
Yes exactly. Placement is defined in `config.yaml` and connection to PDN in `pdn_cfg.tcl`.


[11/19/2025 16:00] polyfractal
great, thank you! out of curiosity, is there a reason placements are done by hand instead of being auto-placed by librelane? because they are so large you want a human to do it?


[11/19/2025 16:02] polyfractal
(entirely new to this whole world, so lacking a lot of background context üôÇ )


[11/19/2025 16:18] mole99
No problem! In our case, manual placement is mostly fine, since there are only a handful of SRAM macros to place.
There was some effort to integrate OpenROAD's automatic macro placer into LibreLane, but it wasn't completed: https://github.com/librelane/librelane/issues/537


[11/19/2025 16:36] polyfractal
Makes sense. Juice probably isn't worth the squeeze given the nature of projects here. Easier to do it by hand üôÇ


[11/19/2025 16:37] _luke_w_
Not my domain (I do frontend) but I can take a couple of guesses at the reasons:

1. Difficult to move large macros later in pnr due to the number of ripups, so there's a high likelihood of automatic placement backing itself into a corner and making the design unroutable.

2.  Desire for consistency between implementation runs -- implementation is usually iterative with new RTL updates  regularly coming in, and you want to know whether issues are due to RTL changes etc as opposed to just the tools having a bad day

3. The power connections to macros like SRAMs etc are usually hand-tuned for best results, and you don't want to rip this up every time

{Reactions}
üëè üëç

[11/19/2025 16:37] _luke_w_
At least that's for the commercial projects I've worked on. Different dynamics for the new open-source stuff


[11/19/2025 16:38] polyfractal
Ahh interesting!


[11/19/2025 16:39] 246tnt
I'd love to have suggestions though. Like it would just do a rough electrostatic-style placement  of all standard cells and macro to sort of see how things arrange themselves and make sure I'm not placing those macro at a very inconvenient spot.

{Reactions}
‚ù§Ô∏è üíØ

[11/19/2025 16:39] 246tnt
And then I can lock it there and never move it while refining RTL.


[11/19/2025 16:39] _luke_w_
Yeah, like BRAM locking on FPGA üòÖ


[11/19/2025 16:42] _luke_w_
It's a really interesting question, I never thought about it. I just sort of accepted the layout folks at work spent days gently massaging the RAMs into place


[11/19/2025 17:44] polyfractal
still not 100% confident yosys didnt optimize away half the design and my laptop locked up so I'm not sure if it actually completed successfully before I had to go to work...but it did finish enough to generate an output GDS ü•≥ 

so much unused space üòÇ

{Attachments}
project-template_media/Screenshot_From_2025-11-19_08-31-14-25A7F.png
project-template_media/Screenshot_From_2025-11-19_08-30-31-7065F.png

{Reactions}
üëç üëè

[11/19/2025 17:56] logic_anarchy
My custom ASIC KianV SV32 SoC is now finalized!
RV32IMA + Zicntr/Zicsr/Zifencei/SSTC with full MMU ‚Äî running uLinux, Linux, and xv6.
With huge help from @mole99  ‚Äî and thanks to 
@Tim 'mithro' Ansell

{Attachments}
project-template_media/G6IpKybXoAE1ATj-B5552.png
project-template_media/G6IqYgdXkAAk0MJ-1801C.png

{Reactions}
ü•≥ (3) ‚ù§Ô∏è (3) üëç

[11/19/2025 18:08] polyfractal
Started a thread.


[11/19/2025 18:08] logic_anarchy
It will run mailine linux/uLinux/XV6 Unix or newer

{Attachments}
project-template_media/Screenshot_from_2025-11-19_19-01-14-47AD1.png
project-template_media/Screenshot_from_2025-11-19_19-07-16-CE074.png


[11/19/2025 18:30] logic_anarchy
I‚Äôve shared a Python script to render the chip layout from GDS. It‚Äôs pretty slow and memory-hungry, but it works. I‚Äôll put it on my GitHub repo later.

{Attachments}
project-template_media/ieee_export_chip-E6A12.py

{Reactions}
‚ù§Ô∏è

[11/19/2025 18:33] polyfractal
definitely will try that when I get home!


[11/19/2025 18:49] tholin
This script generates 3D models and is multithreaded
https://github.com/AvalonSemiconductors/gfmpw1-multi/blob/main/gds2gltf.py

{Reactions}
‚ù§Ô∏è (2)

[11/19/2025 18:54] logic_anarchy
Richtig geil...danke


[11/19/2025 19:07] mole99
And here is my entry in the list of layout renderers. It simply uses KLayout (`pip install klayout`) to render the layout and can therefore load both GDS and OAS. I disabled the filler layers to make the layout stand out better.


[11/19/2025 19:07] mole99


{Attachments}
project-template_media/fabulous_fpga-A6060.png

{Reactions}
‚ù§Ô∏è (2)

[11/19/2025 19:07] mole99


{Attachments}
project-template_media/lay2img-E79C6.py


[11/19/2025 19:08] mole99
You can run it as `python3 lay2img.py librelane/runs/<timestamp>/final/gds/chip_top.gds image --width 4069 --height 6144` in the root of your repository.


[11/19/2025 19:29] tholin
Rendering the AS2650-2 with @logic anarchy ‚Äôs script shows some missing wires.

{Attachments}
project-template_media/chip-7E506.png


[11/19/2025 19:30] tholin
Watch your RAM use running this, btw. It gets intense.

{Reactions}
üòÆ üíú

[11/19/2025 20:45] mithro_
Super cool!

{Reactions}
‚ù§Ô∏è

[11/19/2025 20:47] mithro_
Started a thread.


[11/19/2025 20:50] mithro_
What MCU is that Hazard3?


[11/19/2025 20:52] mithro_
Started a thread.


[11/19/2025 20:54] mithro_
Automatic macro placement stuff was one of the big things that Google's ML team did for the TPU

{Reactions}
üòÆ

[11/19/2025 20:55] mithro_
https://github.com/google-research/circuit_training

{Embed}
https://github.com/google-research/circuit_training
GitHub - google-research/circuit_training
Contribute to google-research/circuit_training development by creating an account on GitHub.
project-template_media/circuit_training-59747

{Reactions}
üòÆ

[11/19/2025 20:56] _luke_w_
Yep, it's Hazard3. There will be at least two of them once I'm done (one for main game firmware and one for audio processing)


[11/19/2025 20:56] mithro_
What about one for graphics? üòõ


[11/19/2025 20:56] _luke_w_
RISCBoy PPU is already quite programmable


[11/19/2025 20:57] _luke_w_
and can do affine blits and stuff at 1 pix/clk


[11/19/2025 20:57] _luke_w_
so I'm planning to use that with external parallel async SRAM


[11/19/2025 20:57] _luke_w_
serial SPI LCD

{Reactions}
‚ù§Ô∏è

[11/19/2025 20:57] mithro_
@mole99 - Maybe LibreLane needs container limits to stop locking computers up or something?


[11/19/2025 20:58] _luke_w_
would love to do DVI out but if I only have 13 days til final GDS then now is not the time for custom layout üòÖ

{Reactions}
üòÆ

[11/19/2025 20:59] _luke_w_
I'll probably have some std cell-based DCOs on board to play with generating internal clocks but nothing of the quality you'd need for DVI


[11/19/2025 20:59] mithro_
Sleep is for the weak üòâ


[11/19/2025 20:59] _luke_w_
sleep is for two weeks from now


[11/19/2025 21:08] tholin
Oh. Tapeout is that soon?


[11/19/2025 21:08] tholin
Uhhhhh


[11/19/2025 21:08] tholin
Yeah, sleep is indeed for two weeks from now


[11/19/2025 21:11] mithro_
Dammit, there is too many cool things to look at in this channel and I need to be finishing the GDS prechecking on platform.wafer.space

{Reactions}
‚ù§Ô∏è

[11/19/2025 21:13] logic_anarchy
Ja, Leo ist richtig geil!

{Attachments}
project-template_media/chipw-55C88.png

{Reactions}
üëè

[11/19/2025 22:24] mithro_
We definitely need a gallery or something!

{Reactions}
üíØ (2) ‚ù§Ô∏è (2)

[11/19/2025 22:54] polyfractal
hehe well I think we can blame my laptop for this one. the display/linux controlling it seems to get flaky in memory-constrained circumstances


[11/19/2025 22:54] polyfractal
(i also forgot to boost swap before starting it)


[11/20/2025 15:58] logic_anarchy
How we can do the same here, excluding gf180mcu_fd_sc_mcu7t5v0__oai21_1  @mole99 
https://discordapp.com/channels/1009193568256135208/1438584424554827788


==============================================================
Exported 214 message(s)
==============================================================
