AuthorID,Author,Date,Content,Attachments,Reactions
"596068704471482370","246tnt","2025-12-07T10:23:41.5840000+00:00","AFAICT `magic` implements exactly the same method as KLayout and thus can't properly check for antennas either :/ (cc @Tim Edwards )","","ğŸ‘€ (1)"
"323371864074485771","mole99","2025-12-07T10:31:34.3520000+00:00","So, KLayout changes the ratio limit depending on the diode area, instead of increasing the gate area proportionally. Good catch, that is indeed a problem.

In this case, it seems we really need to wait for a fix.

Once a patch has been released, I can update the Nix setup in the template quite quickly. The main bottleneck is therefore whether Matthias has time to take a look at this, and the time that is needed for people to fix their designs afterwards.","",""
"732347216412278825","urish","2025-12-07T10:32:53.2980000+00:00","What about OR, does it calculate the antenna sizes correctly?","",""
"596068704471482370","246tnt","2025-12-07T10:33:53.3770000+00:00","It does the best it can. But AFAIK the LEF contains no information about the metal layers for connectivity of the declared gate/diff area so the check can't be 100%.","",""
"596068704471482370","246tnt","2025-12-07T10:38:03.8250000+00:00","Like pins have only a single line `ANTENNAGATEAREA` / `ANTENNADIFFAREA` which I don't see how that could be used to fully evaluate antenna without knowing what internal layers path.","",""
"709384666909507634","egorxe","2025-12-07T10:38:07.2580000+00:00","@tnt You're right there seems to be nothing of the sort... So the only options for this tapeout would likely be either to ignore KLayout antenna violations in precheck, or to create a temporary KLayout fork which will perform antenna_check the way gf180mcu requires it.","","ğŸ˜® (1)"
"709384666909507634","egorxe","2025-12-07T10:41:05.7220000+00:00","But it should work correctly for the flat design, right?","",""
"596068704471482370","246tnt","2025-12-07T10:44:12.5380000+00:00","For any internal node that doesn't connect to a macro it should be correct. But anything that connect to a macro where the only info is from a LEF could be a problem.","",""
"596068704471482370","246tnt","2025-12-07T10:44:50.0990000+00:00","Now this would include IO pads, but AFAICT the io pads have protection diodes and they did take care of having them connected through metal1/metal2 only so that should be fine.","",""
"596068704471482370","246tnt","2025-12-07T10:46:34.1620000+00:00","For Tiny Tapeout we also have no signal routing on Metal5 and have all the user signal pins on Metal4 so this will work too because pins then act as antenna strap. This was done on purpose exactly for that reason.","",""
"596068704471482370","246tnt","2025-12-07T10:48:22.1930000+00:00","```diff
diff --git a/src/db/db/dbLayoutToNetlist.cc b/src/db/db/dbLayoutToNetlist.cc
index 043f1629c..041b51b06 100644
--- a/src/db/db/dbLayoutToNetlist.cc
+++ b/src/db/db/dbLayoutToNetlist.cc
@@ -1934,6 +1934,7 @@ db::Region LayoutToNetlist::antenna_check (const db::Region &gate, double gate_a
       }
 
       double r = ratio;
+      double da = 0.0;
       bool skip = false;
 
       adiodes_int.clear ();
@@ -1953,7 +1954,7 @@ db::Region LayoutToNetlist::antenna_check (const db::Region &gate, double gate_a
             skip = true;
           }
         } else {
-          r += adiode_int * dbu * dbu * d->second;
+          da += adiode_int * dbu * dbu * d->second;
         }
 
       }
@@ -1965,7 +1966,7 @@ db::Region LayoutToNetlist::antenna_check (const db::Region &gate, double gate_a
 
         compute_area_and_perimeter_of_net_shapes (*cid, *c, layer_of (gate), agate_int, pgate_int);
 
-        double agate = 0.0;
+        double agate = da;
         if (fabs (gate_area_factor) > 1e-6) {
           agate += agate_int * dbu * dbu * gate_area_factor;
         }
```","","ğŸ‘Œ (1),ğŸ‘€ (1)"
"596068704471482370","246tnt","2025-12-07T10:49:45.7580000+00:00","(Although with the patch above, the DRC rule need to be changed, the number passed in the diode check needs to be the Mf, so 15 / 2 and not 6000 / 800 )","",""
"323371864074485771","mole99","2025-12-07T10:50:08.4460000+00:00","I'll try to patch this through the Nix flake.","","â¤ï¸ (1)"
"709384666909507634","egorxe","2025-12-07T10:54:53.7400000+00:00","LibreLane docs recommend supplying netlists for macros if available. But as far as I can tell they are used only in OpenSTA steps. It's probably best to buffer macro pins on the both sides to avoid antenna problems.","","ğŸ‘€ (1)"
"596068704471482370","246tnt","2025-12-07T10:58:18.9370000+00:00","Yeah, netlist wouldn't help for the physical layout, it would need to look at the DEF or GDS of the macro and I don't think it does that. I haven't dug a lot into the OR source code, but AFAIK it only looks at the LEF and that just doesn't have enough info to be correct all the time AFAIU.","",""
